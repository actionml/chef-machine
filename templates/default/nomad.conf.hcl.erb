// because we are in the docker
bind_addr = "0.0.0.0"

// bound to this directory
data_dir = "/data"

// datacenter-settings
region = "<%= @region %>"
datacenter = "<%= @datacenter %>"

advertise {
  http = "<%= node[:ipaddress] %>:4646"
  rpc = "<%= node[:ipaddress] %>:4647"
  serf = "<%= node[:ipaddress] %>:4648"
}

consul {
  # host:port
  address = "<%= node[:ipaddress] %>:8500"
  client_service_name = "nomad-client"
  server_auto_join = false
  client_auto_join = true
}

client {
  enabled = true
  node_class = "<%= @client.node_class %>"
  network_speed = <%= @client.network_speed %>

  chroot_env {
    <%= write_hcl(@client.chroot_env.inject({}) {|h, k| h[k] = k; h}, spaces: 4) %>
  }

  reserved {
    memory = <%= @client.reserved.memory %>
    cpu = <%= @client.reserved.cpu %>
    disk = <%= @client.reserved.disk %>
    reserved_ports = "<%= @client.reserved.ports %>"
  }

  meta {
    <%= write_hcl(@client.meta, spaces: 4) %>
  }

  options {
    <%= write_hcl(@client.options, spaces: 4) %>
  }
}
